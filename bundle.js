(()=>{"use strict";let t=0;class e{constructor(){this.subs=[],this.id=t++}addSub(t){this.subs.push(t)}removeSub(t){!function(t,e){if(!t.length)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}(this.subs,t)}depend(){e.target&&e.target.addDep(this)}notify(){[...this.subs].forEach((t=>t.update()))}}e.target=null;const s=[];function i(t){const e=t.split(".");return function(t){for(let s of e){if(!t)return;t=t[s]}return t}}function n(t){return null!==t&&"object"==typeof t}class r{constructor(t,e,s){this.vm=t,this.cb=s,this.deps=[],this.depIds=new Set,this.newDeps=[],this.newDepIds=new Set,this.getter="function"==typeof e?e:i(e),this.value=this.get()}get(){s.push(e.target),e.target=this;const t=this.vm,i=this.getter.call(t,t);return e.target=s.pop(),this.cleanUpDeps(),i}addDep(t){const e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))}cleanUpDeps(){let t=this.deps.length;for(;t--;){const e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}let e=this.depIds;this.depIds=this.newDepIds,this.newDepIds=e,this.newDepIds.clear(),e=this.deps,this.deps=this.newDeps,this.newDeps=e,this.newDeps.length=0}update(){const t=this.get();if(t!==this.value||n(t)){const e=this.value;this.value=t,this.cb.call(this.vm,t,e)}}}const o={model(t,e,s){t.addEventListener("input",(t=>function(t,e,s){const i=e.split(".");let n=t.$data;for(let t=0;t<i.length-1;t++)n=n[i[t]];n[i.slice(-1)]=s}(s,e,t.target.value)));const n=i(e).call(s,s);return function(){t.value=n}},click(t,e,s){const n=s.$methods&&s.$methods[e];if(n){t.addEventListener("click",n.bind(s),!1);const r=i(e).call(s,s);return function(){t.value=r}}}};class c{constructor(t,e){this.el=h(t)?t:document.querySelector(t),this.vm=e;let s=function(t){let e=document.createDocumentFragment(),s=t.firstChild;for(;s;)e.appendChild(s),s=t.firstChild;return e}(this.el);this.compile(s),this.el.appendChild(s)}compile(t){Array.from(t.childNodes).forEach((t=>{h(t)?this.compileElementNode(t):this.compileTextNode(t)}))}compileElementNode(t){Array.from(t.attributes).forEach((({name:e,value:s})=>{if(e.startsWith("v-")){const i=e.split("-")[1];if(0===i.indexOf("on:")){const e=i.split(":")[1];new r(this.vm,o[e](t,s,this.vm))}else new r(this.vm,o[i](t,s,this.vm))}})),this.compile(t)}compileTextNode(t){/\{\{(.+?)\}\}/g.test(t.textContent)&&new r(this.vm,function(t,e){const s=t.textContent;return function(){const r=s.replace(/\{\{(.+?)\}\}/g,((...t)=>{const s=i(t[1].trim()).call(e,e);return n(s)?JSON.stringify(s,null,1):s}));t.textContent=r}}(t,this.vm))}}function h(t){return 1===t.nodeType}const a=Array.prototype,l=Object.create(a);["push","pop","unshift","shift","splice","reverse","sort"].forEach((t=>{const e=a[t];Object.defineProperty(l,t,{value:function(...s){const i=e.apply(this,s),n=this.__ob__;let r=null;switch(t){case"push":case"unshift":r=s;break;case"splice":r=s.slice(2)}return r&&n.observeArray(r),n.dep.notify(),i},enumerable:!1,writable:!0,configurable:!0})}));const d=l;function u(t){if("object"!=typeof t)return;let e;return e=t.__ob__&&t.__ob__ instanceof p?t.__ob__:new p(t),e}class p{constructor(t){this.value=t,this.dep=new e,function(t,e,s,i=!1){Object.defineProperty(t,e,{value:s,enumerable:i,writable:!0,configurable:!0})}(t,"__ob__",this),Array.isArray(t)?(Object.setPrototypeOf(t,d),this.observeArray(t)):this.walk(t)}walk(t){Object.keys(t).forEach((e=>f(t,e,t[e])))}observeArray(t){t.forEach((t=>u(t)))}}function f(t,s,i){const n=new e;let r=u(i);Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:function(){return e.target&&(n.depend(),r&&(r.dep.depend(),Array.isArray(i)&&b(i))),i},set:function(t){i!==t&&(i=t,r=u(t),n.notify())}})}function b(t){for(let e of t)e&&e.__ob__&&e.__ob__.dep.depend(),Array.isArray(e)&&b(e)}window.MVVM=class{constructor(t){this.$el=t.el,this.$data=t.data,this.$methods=t.methods,this.proxyData(this.$data),u(this.$data),this.$el&&new c(this.$el,this)}proxyData(t){Object.keys(t).forEach((e=>{Object.defineProperty(this,e,{get:()=>t[e],set(s){t[e]!==s&&(t[e]=s)}})}))}$set(t,e,s){if(Array.isArray(t))return t.length=Math.max(t.length,e),t.splice(e,1,s),s;if(e in t&&!(e in Object.prototype))return t[e]=s,s;const i=t.__ob__;return i?(f(t,e,s),i.dep.notify(),s):(t[e]=s,s)}$delete(t,e){if(Array.isArray(t))return void t.splice(e,1);const s=t.__ob__;t.hasOwnProperty(e)&&(delete t[e],s&&s.dep.notify())}}})();